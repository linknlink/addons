<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkNLink Edge - æ™ºèƒ½å®¶å±…è¾¹ç¼˜è®¡ç®—å¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            text-decoration: none;
            color: inherit;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .card-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .card h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .card p {
            color: #7f8c8d;
            line-height: 1.6;
        }

        .status-bar {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .status-item {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .status-value {
            font-size: 2rem;
            font-weight: bold;
            color: #27ae60;
            margin-bottom: 5px;
        }

        .status-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .footer {
            text-align: center;
            color: white;
            opacity: 0.8;
            margin-top: 40px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .status-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”— LinkNLink Edge</h1>
            <p>æ™ºèƒ½å®¶å±…è¾¹ç¼˜è®¡ç®—å¹³å°</p>
        </div>

        <div class="status-bar">
            <div class="status-grid">
                <div class="status-item">
                    <div class="status-value" id="deviceCount">-</div>
                    <div class="status-label">è®¾å¤‡æ•°é‡</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="entityCount">-</div>
                    <div class="status-label">å®ä½“æ•°é‡</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="wsConnections">-</div>
                    <div class="status-label">WebSocketè¿æ¥</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="systemStatus">-</div>
                    <div class="status-label">ç³»ç»ŸçŠ¶æ€</div>
                </div>
            </div>
        </div>

        <div class="dashboard">
            <a href="/linknlinkedge/web/unified_dashboard.html" class="card">
                <div class="card-icon">ğŸ </div>
                <h3>ç»Ÿä¸€ç®¡ç†ç•Œé¢</h3>
                <p>è®¾å¤‡ç®¡ç†ã€å®ä½“ç®¡ç†ã€çŠ¶æ€ç›‘æ§çš„ç»Ÿä¸€æ“ä½œç•Œé¢ï¼Œæ”¯æŒå®æ—¶æ•°æ®å±•ç¤ºå’Œè¿œç¨‹æ§åˆ¶ã€‚</p>
            </a>

            <a href="/linknlinkedge/web/mqtt_advanced_test.html" class="card">
                <div class="card-icon">ğŸ“¡</div>
                <h3>MQTTæµ‹è¯•å·¥å…·</h3>
                <p>é«˜çº§MQTTè®¾å¤‡æµ‹è¯•å·¥å…·ï¼Œæ”¯æŒè®¾å¤‡å‘ç°ã€çŠ¶æ€ä¸ŠæŠ¥ã€æ§åˆ¶å‘½ä»¤ç­‰å®Œæ•´æµç¨‹æµ‹è¯•ã€‚</p>
            </a>

            <a href="/linknlinkedge/web/unified_topic_test.html" class="card">
                <div class="card-icon">ğŸ”§</div>
                <h3>ç»Ÿä¸€ä¸»é¢˜æµ‹è¯•</h3>
                <p>ç»Ÿä¸€ä¸»é¢˜åç¼€æ–¹æ¡ˆæµ‹è¯•å·¥å…·ï¼Œä½¿ç”¨å›ºå®šçš„status/set/availability/attributesåç¼€ã€‚</p>
            </a>

            <a href="/linknlinkedge/web/simple_dashboard.html" class="card">
                <div class="card-icon">ğŸ“Š</div>
                <h3>ç®€å•ä»ªè¡¨æ¿</h3>
                <p>ç®€åŒ–çš„è®¾å¤‡çŠ¶æ€ç›‘æ§ç•Œé¢ï¼Œå¿«é€ŸæŸ¥çœ‹è®¾å¤‡çŠ¶æ€å’ŒåŸºæœ¬ä¿¡æ¯ã€‚</p>
            </a>


        </div>

        <div class="footer">
            <p>&copy; 2024 LinkNLink Edge. æ™ºèƒ½å®¶å±…è¾¹ç¼˜è®¡ç®—å¹³å°</p>
        </div>
    </div>

    <script>
        // è·å–ç³»ç»ŸçŠ¶æ€
        async function fetchSystemStatus() {
            try {
                const response = await fetch('/linknlinkedge/health');
                const data = await response.json();
                
                document.getElementById('systemStatus').textContent = data.status === 'ok' ? 'æ­£å¸¸' : 'å¼‚å¸¸';
                
                if (data.services && data.services.websocket) {
                    document.getElementById('wsConnections').textContent = data.services.websocket.connected_clients || 0;
                }
            } catch (error) {
                console.error('è·å–ç³»ç»ŸçŠ¶æ€å¤±è´¥:', error);
                document.getElementById('systemStatus').textContent = 'é”™è¯¯';
            }
        }

        // è·å–è®¾å¤‡æ•°é‡
        async function fetchDeviceCount() {
            try {
                const response = await fetch('/linknlinkedge/api/devices');
                const data = await response.json();
                document.getElementById('deviceCount').textContent = data.devices ? data.devices.length : 0;
            } catch (error) {
                console.error('è·å–è®¾å¤‡æ•°é‡å¤±è´¥:', error);
                document.getElementById('deviceCount').textContent = '-';
            }
        }

        // è·å–å®ä½“æ•°é‡
        async function fetchEntityCount() {
            try {
                const response = await fetch('/linknlinkedge/api/entities');
                const data = await response.json();
                document.getElementById('entityCount').textContent = data.entities ? data.entities.length : 0;
            } catch (error) {
                console.error('è·å–å®ä½“æ•°é‡å¤±è´¥:', error);
                document.getElementById('entityCount').textContent = '-';
            }
        }

        // åˆå§‹åŒ–é¡µé¢
        function init() {
            fetchSystemStatus();
            fetchDeviceCount();
            fetchEntityCount();
            
            // æ¯30ç§’æ›´æ–°ä¸€æ¬¡çŠ¶æ€
            setInterval(() => {
                fetchSystemStatus();
                fetchDeviceCount();
                fetchEntityCount();
            }, 30000);
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
